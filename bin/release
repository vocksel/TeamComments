#! /usr/bin/env node

const fs = require('fs')
const { join } = require('path')
const { execSync } = require('child_process')
const readline = require('readline')

const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

const configPath = join(process.cwd(), 'src/Config.lua')
const buffer = fs.readFileSync(configPath)
const source = buffer.toString('utf-8').trim()

const [currentVersion] = source.match(/(\d\.\d\.\d)/g)

console.log(`current version: ${currentVersion}`)

rl.question('new version: ', (newVersion) => {
    rl.close()

    const newSource = source.replace(currentVersion, newVersion)

    execSync('git reset')

    console.log(`updating ${configPath} with new version...`)
    fs.writeFileSync(configPath, newSource)

    console.log('commiting changes...')
    execSync('git add src/Config.lua')
    execSync(`git commit -m "Version ${newVersion}`)

    console.log(`version bumped to ${newVersion}`)
})

